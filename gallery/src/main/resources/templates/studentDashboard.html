<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>All Projects</title>

    <!-- Bootstrap & Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/assets/css/navBar.css">
    <link rel="stylesheet" href="/assets/css/footer.css">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>

    <!-- favicon -->
    <link rel="icon" type="image/x-icon" href="/assets/images/website/Future_Proof_Logo_Icon.png">
    <style>
        body {
            background-color:#3A9A9F;
            padding-top: 100px;
        }
        .nav-link {
            color: #4c6873 !important;
            font-weight: 500;
            margin: 0 6px;
            transition: color 0.2s ease;
        }
        .nav-link:hover, .nav-link.active {
            color: #005b73 !important;
        }
        .navbar-brand span {
            font-size: 1.2rem;
            letter-spacing: 0.5px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 10px;
        }
        th {
            background-color: #f8f9fa;
        }

        .actions {
            display: flex;
            gap: 8px;
        }
        .add-projects-button {
            background-color: #0d6efd;
            color: white;
            padding: 8px 12px;
            text-decoration: none;
            border-radius: 4px;
        }
        .edit-button {
            background-color: #2196F3;
            color: white;
            padding: 6px 10px;
            text-decoration: none;
            border-radius: 4px;
        }
        .delete-button {
            background-color: #d9534f;
            color: white;
            padding: 6px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Modal override */
        .modal-custom-img { max-width: 100%; margin-bottom: 10px; border-radius: 6px; }
    </style>
</head>

<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top shadow-sm" th:with="user=${session.loggedInUser}">
    <div class="container-fluid">
        <a class="navbar-brand d-flex align-items-center" th:href="@{/MainGallery/HomePage}">
            <img src="/assets/images/website/Future_Proof_Logo.png" alt="Logo" height="40" class="me-2">
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent"
                aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse justify-content-end" id="navbarContent">
            <ul class="navbar-nav mb-2 mb-lg-0 align-items-lg-center">
                <li class="nav-item"><a class="nav-link" th:href="@{/MainGallery/HomePage}">Home</a></li>

                <li class="nav-item"><a class="nav-link" href="#footer-contact">Contact</a></li>

                <li class="nav-item" th:if="${user == null}">
                    <a class="nav-link text-primary" th:href="@{/MainGallery/Register}">Register</a>
                </li>
                <li class="nav-item" th:if="${user == null}">
                    <a class="nav-link text-primary" th:href="@{/MainGallery/Login}">Login</a>
                </li>

                <li>
        <span class ="dashboard" th:if="${user != null}" th:switch="${#strings.toLowerCase(user.userType)}">
    <a th:case="'admin'"        th:href="@{/MainGallery/adminDashboard}">Dashboard</a>
    <a th:case="'senioradmin'"  th:href="@{/MainGallery/seniorAdminDashboard}">Dashboard</a>
    <a th:case="'student'"      th:href="@{/MainGallery/studentDashboard}">Dashboard</a>
    <a th:case="'employer'"     th:href="@{/MainGallery/employerDashboard}">Dashboard</a>
    <a th:case="*"              th:href="@{/MainGallery/dashboard}">Dashboard</a>
  </span>
                </li>

            </ul>

            <!-- Profile Icon -->
            <a th:if="${user != null}" th:href="@{/MainGallery/profile}">
                <img src="/assets/images/website/Profile.png" alt="Profile_Icon" height="40" class="me-2">
            </a>
            <a th:if="${user == null}" th:href="@{/MainGallery/Login}">
                <img src="/assets/images/website/Profile.png" alt="Profile_Icon" height="40" class="me-2">
            </a>
        </div>
    </div>
</nav>

<!-- End of NavBar -->

<!-- PAGE CONTENT -->
<div class="container my-5">
    <h1 class="mb-4">All Projects</h1>

    <!-- Search -->
    <div class="d-flex justify-content-end mb-3">
        <input type="text" id="liveSearch" placeholder="Search projects..." class="form-control w-auto" style="max-width:250px;">
    </div>

    <!-- Add Project Button -->
    <div class="mb-3">
        <a href="/project/add" class="add-projects-button btn btn-primary"><i class="fas fa-plus"></i> Add New Project</a>
    </div>

    <!-- Table -->
    <div class="table-responsive shadow-sm bg-white p-3 rounded">
        <table class="table table-bordered align-middle">
            <thead>
            <tr>
                <th>Project Name</th>
                <th>Description</th>
                <th>Image</th>
                <th>Details</th>
                <th>Showcase</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="projects : ${projects}">
                <td th:text="${projects.projectName}"></td>
                <td th:text="${projects.projectDescription}"></td>

                <td>
                    <img th:src="@{'/assets/images/projects/thumbnail/thumb_' + ${projects.projectHeroImage}}" width="120" height="80" class="rounded shadow-sm">
                </td>

                <td>
                    <button type="button" class="btn btn-outline-info btn-sm"
                            th:attr="onclick='openModal(`' + ${projects.projectName} + '`,`' + ${projects.projectDescription} + '`,`' + ${projects.category} + '`,`' + ${projects.creationDate} + '`,`' + ${projects.projectDescriptionSummary} + '`,`' + ${projects.projectHeroImage} + '`,`' + ${projects.additionalDoc} + '`)'">
                        <i class="fas fa-eye"></i> View
                    </button>
                </td>

                <td>
                    <form th:action="@{/showcase/add}" method="post">
                        <input type="hidden" name="projectId" th:value="${projects.projectId}">
                        <button type="submit" class="btn btn-warning btn-sm text-white">
                            <i class="fas fa-star"></i> Add
                        </button>
                    </form>
                </td>

                <td>
                    <div class="actions">
                        <a th:href="@{/project/edit/{id}(id=${projects.projectId})}" class="edit-button btn btn-primary btn-sm">
                            <i class="fas fa-edit"></i>
                        </a>

                        <form th:action="@{/project/delete}" method="post" onsubmit="confirmDelete(event)">
                            <input type="hidden" name="ProjectID" th:value="${projects.projectId}">
                            <button type="submit" class="delete-button btn btn-danger btn-sm">
                                <i class="fas fa-trash"></i>
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="detailsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white">
                <h5 class="modal-title">Project Details</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <h4 id="modalProjectName"></h4>
                <img id="modalImage" class="modal-custom-img">
                <p><strong>Description:</strong> <span id="modalDescription"></span></p>
                <p><strong>Category:</strong> <span id="modalCategory"></span></p>
                <p><strong>Created:</strong> <span id="modalCreated"></span></p>
                <p><strong>Summary:</strong> <span id="modalSummary"></span></p>
                <p id="modalDoc"></p>
            </div>
            <div class="modal-footer bg-light">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>

</div>
<!-- Manual Pagination Controls -->
<div class="d-flex justify-content-center mt-3">
    <nav>
        <ul class="pagination" id="pagination">
            <!-- Will be filled by JS -->
        </ul>
    </nav>
</div>

<!-- FOOTER -->

<footer class="fp-footer" id="footer-contact">

    <div class="fp-footer-container">

        <!-- LEFT -->
        <div class="fp-footer-left">
            <img src="/assets/images/website/Future_Proof_Logo.png" class="fp-logo" alt="FutureProof Logo">

            <p class="fp-tagline">
                Empowering students to showcase their<br>
                skills and connect with employers<br>
                – from portfolio to profession.
            </p>

            <div class="fp-socials">
                <a href="#"><img src="/assets/images/website/twitter.png" alt="X"></a>
                <a href="#"><img src="/assets/images/website/linkedin.png" alt="LinkedIn"></a>
                <a href="#"><img src="/assets/images/website/facebook.png" alt="Facebook"></a>
                <a href="#"><img src="/assets/images/website/instagram.png" alt="Instagram"></a>
            </div>
        </div>

        <!-- RIGHT GROUP (middle + right) -->
        <div class="fp-footer-right-group">

            <!-- Middle Column -->
            <div class="fp-footer-column">
                <h4>Technological University of<br>The Shannon</h4>
                <p>
                    Athlone Campus<br>
                    University Road, Athlone<br>
                    Co. Westmeath<br>
                    N37 HD68
                </p>
                <p>
                    Phone: <a href="tel:+3539096468000">+353 90 6468000</a><br>
                    Email: <a href="mailto:reception.midlands@tus.ie">reception.midlands@tus.ie</a>
                </p>
            </div>

            <!-- Right Column -->
            <div class="fp-footer-column">
                <h4>Technological University of<br>The Shannon</h4>
                <p>
                    Moylish Campus<br>
                    Moylish Park<br>
                    Limerick<br>
                    V94 EC5T
                </p>
                <p>
                    Phone: <a href="tel:+35361293000">+353 61 293000</a><br>
                    Email: <a href="mailto:reception.midwest@tus.ie">reception.midwest@tus.ie</a>
                </p>
            </div>

        </div>

    </div>

    <img src="/assets/images/website/Future_Proof_Icon_Logo_Low_Opacity.png" class="fp-footer-watermark" alt="">
</footer>

<script>
    /* ===========================
       MODAL FUNCTION
    ============================ */
    function openModal(name, description, category, created, summary, image, doc) {
        document.getElementById("modalProjectName").textContent = name;
        document.getElementById("modalDescription").textContent = description;
        document.getElementById("modalCategory").textContent = category;
        document.getElementById("modalCreated").textContent = created;
        document.getElementById("modalSummary").textContent = summary;

        const img = document.getElementById("modalImage");
        img.src = image ? "/uploads/" + image : "";
        img.style.display = image ? "block" : "none";

        const modalDoc = document.getElementById("modalDoc");
        modalDoc.innerHTML = doc && doc !== "null"
            ? `<strong>Additional Document:</strong> <a href="/uploads/${doc}" target="_blank">View / Download</a>`
            : `<strong>Additional Document:</strong> None`;

        new bootstrap.Modal(document.getElementById("detailsModal")).show();
    }

    /* ===========================
       DELETE CONFIRMATION
    ============================ */
    function confirmDelete(event) {
        event.preventDefault();
        if (confirm("Are you sure you want to delete this project?")) {
            event.target.submit();
        }
    }

    /* ===========================
       MANUAL PAGINATION
    ============================ */

    const rowsPerPage = 5;
    let currentPage = 1;

    function showPage(page) {
        const rows = document.querySelectorAll("tbody tr");
        const filter = document.getElementById("liveSearch").value.toLowerCase();

        // Filter rows
        let visibleRows = Array.from(rows).filter(row =>
            row.textContent.toLowerCase().includes(filter)
        );

        // Hide all rows first
        rows.forEach(row => row.style.display = "none");

        // Determine total pages
        const totalPages = Math.ceil(visibleRows.length / rowsPerPage);

        // Prevent page out of range
        if (page < 1) page = 1;
        if (page > totalPages) page = totalPages;
        currentPage = page;

        // Show rows for selected page
        const start = (page - 1) * rowsPerPage;
        const end = start + rowsPerPage;
        visibleRows.slice(start, end).forEach(row => row.style.display = "");

        buildPagination(totalPages);
    }

    function buildPagination(totalPages) {
        const pagination = document.getElementById("pagination");
        pagination.innerHTML = "";

        if (totalPages <= 1) return;

        // Previous button
        let prev = document.createElement("li");
        prev.className = "page-item " + (currentPage === 1 ? "disabled" : "");
        prev.innerHTML = `<a class="page-link" href="#">Previous</a>`;
        prev.onclick = () => currentPage > 1 && showPage(currentPage - 1);
        pagination.appendChild(prev);

        // Page numbers
        for (let i = 1; i <= totalPages; i++) {
            let li = document.createElement("li");
            li.className = "page-item " + (i === currentPage ? "active" : "");
            li.innerHTML = `<a class="page-link" href="#">${i}</a>`;
            li.onclick = () => showPage(i);
            pagination.appendChild(li);
        }

        // Next button
        let next = document.createElement("li");
        next.className = "page-item " + (currentPage === totalPages ? "disabled" : "");
        next.innerHTML = `<a class="page-link" href="#">Next</a>`;
        next.onclick = () => currentPage < totalPages && showPage(currentPage + 1);
        pagination.appendChild(next);
    }

    /* ===========================
       LIVE SEARCH — DOES NOT AUTO CHANGE PAGE
    ============================ */
    document.getElementById("liveSearch").addEventListener("keyup", function () {
        showPage(currentPage);
    });

    /* ===========================
       INITIAL LOAD
    ============================ */
    window.onload = () => showPage(1);
</script>


</body>
</html>
