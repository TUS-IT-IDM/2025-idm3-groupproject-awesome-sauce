<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>All Projects</title>

    <!-- Bootstrap & Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>

    <!-- favicon -->
    <link rel="icon" type="image/x-icon" href="/assets/images/website/Future_Proof_Logo_Icon.png">
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 10px;
        }
        th {
            background-color: #f8f9fa;
        }

        .actions {
            display: flex;
            gap: 8px;
        }
        .add-projects-button {
            background-color: #0d6efd;
            color: white;
            padding: 8px 12px;
            text-decoration: none;
            border-radius: 4px;
        }
        .edit-button {
            background-color: #2196F3;
            color: white;
            padding: 6px 10px;
            text-decoration: none;
            border-radius: 4px;
        }
        .delete-button {
            background-color: #d9534f;
            color: white;
            padding: 6px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Modal override */
        .modal-custom-img { max-width: 100%; margin-bottom: 10px; border-radius: 6px; }
    </style>
</head>

<body class="bg-light">

<!-- HEADER -->
<header class="header p-3 border-bottom bg-white" th:with="user=${session.loggedInUser}">
    <div class="container d-flex justify-content-between align-items-center">
        <a th:href="@{/MainGallery/HomePage}" class="logo fs-4 fw-bold text-decoration-none">LOGO GOES HERE</a>

        <nav class="nav-items d-flex align-items-center gap-3">
            <a th:href="@{/MainGallery/HomePage}" class="text-decoration-none">Home</a>
            <a th:if="${user == null}" th:href="@{/MainGallery/Register}" class="text-primary text-decoration-none">Register</a>
            <a th:if="${user == null}" th:href="@{/MainGallery/Login}" class="text-primary text-decoration-none">Sign-In</a>
            <a th:if="${user != null}" th:href="@{/MainGallery/profile}" class="text-decoration-none">Profile</a>
            <a th:if="${user != null}" th:href="@{/MainGallery/Logout}" onclick="return confirm('Log out now?')" class="text-decoration-none">Logout</a>
        </nav>
    </div>
</header>

<!-- PAGE CONTENT -->
<div class="container my-5">
    <h1 class="mb-4">All Projects</h1>

    <!-- Search -->
    <div class="d-flex justify-content-end mb-3">
        <input type="text" id="liveSearch" placeholder="Search projects..." class="form-control w-auto" style="max-width:250px;">
    </div>

    <!-- Add Project Button -->
    <div class="mb-3">
        <a href="/project/add" class="add-projects-button btn btn-primary"><i class="fas fa-plus"></i> Add New Project</a>
    </div>

    <!-- Table -->
    <div class="table-responsive shadow-sm bg-white p-3 rounded">
        <table class="table table-bordered align-middle">
            <thead>
            <tr>
                <th>Project Name</th>
                <th>Description</th>
                <th>Image</th>
                <th>Details</th>
                <th>Showcase</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="projects : ${projects}">
                <td th:text="${projects.projectName}"></td>
                <td th:text="${projects.projectDescription}"></td>

                <td>
                    <img th:src="@{'/assets/images/projects/thumbnail/thumb_' + ${projects.projectHeroImage}}" width="120" height="80" class="rounded shadow-sm">
                </td>

                <td>
                    <button type="button" class="btn btn-outline-info btn-sm"
                            th:attr="onclick='openModal(`' + ${projects.projectName} + '`,`' + ${projects.projectDescription} + '`,`' + ${projects.category} + '`,`' + ${projects.creationDate} + '`,`' + ${projects.projectDescriptionSummary} + '`,`' + ${projects.projectHeroImage} + '`,`' + ${projects.additionalDoc} + '`)'">
                        <i class="fas fa-eye"></i> View
                    </button>
                </td>

                <td>
                    <form th:action="@{/showcase/add}" method="post">
                        <input type="hidden" name="projectId" th:value="${projects.projectId}">
                        <button type="submit" class="btn btn-warning btn-sm text-white">
                            <i class="fas fa-star"></i> Add
                        </button>
                    </form>
                </td>

                <td>
                    <div class="actions">
                        <a th:href="@{/project/edit/{id}(id=${projects.projectId})}" class="edit-button btn btn-primary btn-sm">
                            <i class="fas fa-edit"></i>
                        </a>

                        <form th:action="@{/project/delete}" method="post" onsubmit="confirmDelete(event)">
                            <input type="hidden" name="ProjectID" th:value="${projects.projectId}">
                            <button type="submit" class="delete-button btn btn-danger btn-sm">
                                <i class="fas fa-trash"></i>
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="detailsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white">
                <h5 class="modal-title">Project Details</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <h4 id="modalProjectName"></h4>
                <img id="modalImage" class="modal-custom-img">
                <p><strong>Description:</strong> <span id="modalDescription"></span></p>
                <p><strong>Category:</strong> <span id="modalCategory"></span></p>
                <p><strong>Created:</strong> <span id="modalCreated"></span></p>
                <p><strong>Summary:</strong> <span id="modalSummary"></span></p>
                <p id="modalDoc"></p>
            </div>
            <div class="modal-footer bg-light">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>

</div>
<!-- Manual Pagination Controls -->
<div class="d-flex justify-content-center mt-3">
    <nav>
        <ul class="pagination" id="pagination">
            <!-- Will be filled by JS -->
        </ul>
    </nav>
</div>

<!-- FOOTER -->
<footer class="text-center text-muted py-4 border-top mt-5 bg-white">© 2024 TUS GALLERY</footer>

<script>
    /* ===========================
       MODAL FUNCTION
    ============================ */
    function openModal(name, description, category, created, summary, image, doc) {
        document.getElementById("modalProjectName").textContent = name;
        document.getElementById("modalDescription").textContent = description;
        document.getElementById("modalCategory").textContent = category;
        document.getElementById("modalCreated").textContent = created;
        document.getElementById("modalSummary").textContent = summary;

        const img = document.getElementById("modalImage");
        img.src = image ? "/uploads/" + image : "";
        img.style.display = image ? "block" : "none";

        const modalDoc = document.getElementById("modalDoc");
        modalDoc.innerHTML = doc && doc !== "null"
            ? `<strong>Additional Document:</strong> <a href="/uploads/${doc}" target="_blank">View / Download</a>`
            : `<strong>Additional Document:</strong> None`;

        new bootstrap.Modal(document.getElementById("detailsModal")).show();
    }

    /* ===========================
       DELETE CONFIRMATION
    ============================ */
    function confirmDelete(event) {
        event.preventDefault();
        if (confirm("Are you sure you want to delete this project?")) {
            event.target.submit();
        }
    }

    /* ===========================
       MANUAL PAGINATION
    ============================ */

    const rowsPerPage = 5;
    let currentPage = 1;

    function showPage(page) {
        const rows = document.querySelectorAll("tbody tr");
        const filter = document.getElementById("liveSearch").value.toLowerCase();

        // Filter rows
        let visibleRows = Array.from(rows).filter(row =>
            row.textContent.toLowerCase().includes(filter)
        );

        // Hide all rows first
        rows.forEach(row => row.style.display = "none");

        // Determine total pages
        const totalPages = Math.ceil(visibleRows.length / rowsPerPage);

        // Prevent page out of range
        if (page < 1) page = 1;
        if (page > totalPages) page = totalPages;
        currentPage = page;

        // Show rows for selected page
        const start = (page - 1) * rowsPerPage;
        const end = start + rowsPerPage;
        visibleRows.slice(start, end).forEach(row => row.style.display = "");

        buildPagination(totalPages);
    }

    function buildPagination(totalPages) {
        const pagination = document.getElementById("pagination");
        pagination.innerHTML = "";

        if (totalPages <= 1) return;

        // Previous button
        let prev = document.createElement("li");
        prev.className = "page-item " + (currentPage === 1 ? "disabled" : "");
        prev.innerHTML = `<a class="page-link" href="#">Previous</a>`;
        prev.onclick = () => currentPage > 1 && showPage(currentPage - 1);
        pagination.appendChild(prev);

        // Page numbers
        for (let i = 1; i <= totalPages; i++) {
            let li = document.createElement("li");
            li.className = "page-item " + (i === currentPage ? "active" : "");
            li.innerHTML = `<a class="page-link" href="#">${i}</a>`;
            li.onclick = () => showPage(i);
            pagination.appendChild(li);
        }

        // Next button
        let next = document.createElement("li");
        next.className = "page-item " + (currentPage === totalPages ? "disabled" : "");
        next.innerHTML = `<a class="page-link" href="#">Next</a>`;
        next.onclick = () => currentPage < totalPages && showPage(currentPage + 1);
        pagination.appendChild(next);
    }

    /* ===========================
       LIVE SEARCH — DOES NOT AUTO CHANGE PAGE
    ============================ */
    document.getElementById("liveSearch").addEventListener("keyup", function () {
        showPage(currentPage);
    });

    /* ===========================
       INITIAL LOAD
    ============================ */
    window.onload = () => showPage(1);
</script>


</body>
</html>
