<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" type="text/css" href="/assets/css/lcstyle.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body>

<!-- HEADER -->
<header class="header" th:with="user=${session.loggedInUser}">
  <a th:href="@{/MainGallery/HomePage}" class="logo">LOGO GOES HERE</a>

  <nav class="nav-items" th:with="user=${session.loggedInUser}">
    <a th:href="@{/MainGallery/HomePage}">Home</a>
    <a th:href="@{/MainGallery/about}">About</a>
    <a th:href="@{/MainGallery/contact}">Contact</a>

    <!-- Not logged in -->
    <a th:if="${user == null}" th:href="@{/MainGallery/Register}" style="color: blue;">Register</a>
    <a th:if="${user == null}" th:href="@{/MainGallery/Login}" style="color: blue;">Login</a>

    <!-- Logged in: role-aware Dashboard + Logout -->
    <span th:if="${user != null}" th:switch="${#strings.toLowerCase(user.userType)}">
      <a th:case="'admin'"        th:href="@{/MainGallery/adminDashboard}">Dashboard</a>
      <a th:case="'senioradmin'"  th:href="@{/MainGallery/seniorAdminDashboard}">Dashboard</a>
      <a th:case="'student'"      th:href="@{/MainGallery/studentDashboard}">Dashboard</a>
      <a th:case="'employer'"     th:href="@{/MainGallery/employerDashboard}">Dashboard</a>
      <a th:case="*"              th:href="@{/MainGallery/dashboard}">Dashboard</a>
    </span>

    <!-- Logout -->
    <a th:if="${user != null}" th:href="@{/MainGallery/Logout}" onclick="return confirm('Log out now?')">Logout</a>

    <!-- Profile Icon -->
    <div class="icon-button" th:with="isLoggedIn=${user != null}">
      <a th:if="${isLoggedIn}" th:href="@{/MainGallery/profile}">
        <i class="fas fa-user"></i>
      </a>
      <a th:if="${!isLoggedIn}" th:href="@{/MainGallery/Login}">
        <i class="fas fa-user"></i>
      </a>
    </div>

    <!-- ðŸ” PROJECT SEARCH SECTION -->
    <div class="container mt-5">

      <!-- Search Form -->
      <form th:action="@{/MainGallery/searchProjects}" method="get" class="d-flex gap-2 mb-4">
        <input type="text" name="keyword"
               th:value="${keyword}"
               placeholder="Search projects..."
               class="form-control"
               style="max-width: 400px;">
        <button><i class="fas fa-search"></i></a></button>
      </form>

      <!-- Results Table -->
      <div th:if="${projects != null}">
        <table class="table table-striped table-hover">
          <thead class="table-dark">
          <tr>
            <th>ID</th>
            <th>Project Name</th>
            <th>Description</th>
            <th>Owner</th>
            <th>Image</th>
          </tr>
          </thead>
          <tbody>
          <tr th:each="project : ${projects}">
            <td th:text="${project.projectId}"></td>
            <td th:text="${project.projectName}"></td>
            <td th:text="${project.projectDescription}"></td>
            <td th:text="${project.user?.emailAddress}">Unknown</td>
            <td>
              <img th:src="@{'/assets/images/projects/thumbnail/thumb_' + ${project.projectHeroImage}}"
                   alt="Project Image"
                   width="100"
                   style="object-fit: cover;">
            </td>
          </tr>
          <tr th:if="${#lists.isEmpty(projects)}">
            <td colspan="5" class="text-center text-muted">
              No projects found for "<span th:text="${keyword}"></span>".
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>

  </nav>
</header>
<!-- /HEADER -->




<!-- Employer Messages -->
<div class="container mt-3">
  <div th:if="${message}" class="alert alert-success text-center" th:text="${message}"></div>
  <div th:if="${error}" class="alert alert-danger text-center" th:text="${error}"></div>
</div>

<!-- Carousel -->
<div id="demo" class="carousel slide" data-bs-ride="carousel">
  <div class="carousel-indicators">
    <div th:each="liveShowcase, iterStat : ${AllLiveShowcases}">
      <button type="button" data-bs-target="#demo"
              th:data-bs-slide-to="${iterStat.index}"
              th:classappend="${iterStat.first ? 'active' : ''}"></button>
    </div>
  </div>

  <div class="carousel-inner">
    <div th:each="liveShowcase, iterStat : ${AllLiveShowcases}"
         th:classappend="${iterStat.first ? 'carousel-item active' : 'carousel-item'}">

      <img th:src="@{'/assets/images/showcases/thumbnail/thumb_' + ${liveShowcase.image}}"
           alt="Showcase Image"
           class="d-block w-100"
           style="height: 400px; object-fit: cover;" />

      <div class="carousel-caption">
        <h5 th:text="${liveShowcase.name}"></h5>
        <p th:text="${liveShowcase.description}"></p>

        <a th:if="${liveShowcase.showcaseId != null}"
           th:href="@{/MainGallery/browseShowcase/{id}(id=${liveShowcase.showcaseId})}"
           class="btn btn-primary">
          Browse the Showcase
        </a>
      </div>
    </div>
  </div>


  <button class="carousel-control-prev" type="button" data-bs-target="#demo" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#demo" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
  </button>
</div>

<!-- Intro Section -->
<div class="container mt-4">
  <div class="row">
    <div class="col-lg-4 col-md-6 col-sm-12 mb-4">
      <div class="work text-center">
        <i class="fas fa-layer-group" style="font-size: 2rem; margin-top: 20px;"></i>
        <p class="work-heading" style="font-size: 24px;"><strong>Projects</strong></p>
        <p class="work-text">Our mission is to provide a stage where students can showcase their creativity, skills, and innovative projects to a global audience.</p>
      </div>
    </div>
    <div class="col-lg-4 col-md-6 col-sm-12 mb-4">
      <div class="work text-center">
        <i class="fas fa-seedling" style="font-size: 2rem; margin-top: 20px;"></i>
        <p class="work-heading" style="font-size: 24px;"><strong>Connect</strong></p>
        <p class="work-text">We are a dynamic platform proudly offered by TUS, dedicated to empowering students and bridging the gap between education and industry.</p>
      </div>
    </div>
    <div class="col-lg-4 col-md-6 col-sm-12 mb-4">
      <div class="work text-center">
        <i class="fas fa-circle-nodes" style="font-size: 2rem; margin-top: 20px;"></i>
        <p class="work-heading" style="font-size: 24px;"><strong>Network</strong></p>
        <p class="work-text">If you're an employer seeking the brightest minds, TUS Gallery is your trusted partner on this exciting educational and professional adventure.</p>
      </div>
    </div>
  </div>
</div>

<!-- Projects Section -->
<div class="container mt-4">
  <h3 class="text-left mb-4">Recently Added Projects</h3>
  <div class="row">
    <div class="col-lg-4 col-md-6 col-sm-12 mb-4" th:each="project : ${AllProjectsRecentFirst}">
      <div class="card">
        <img th:src="@{'/assets/images/projects/thumbnail/thumb_' + ${project.projectHeroImage}}"
             class="card-img-top" alt="Project Image" style="height: 200px; object-fit: cover;" />
        <div class="card-body">
          <h5 class="card-title" th:text="${project.projectName}"></h5>
          <p class="card-text" style="max-height: 3rem; overflow: hidden;"
             th:text="${project.projectDescription}"></p>

          <!-- See Project button -->
          <a th:href="@{'/project/projectDetails/' + ${project.projectId}}" class="btn btn-primary btn-sm">See Project</a>

          <!-- Save to List with optional note (employers only) -->
          <th:block th:with="user=${session.loggedInUser}">
            <th:block th:if="${user != null and #strings.equalsIgnoreCase(user.userType, 'employer')}">
              <form th:action="@{/MainGallery/employer/saveProject}" method="post"
                    style="display:inline-block; margin-left:8px; max-width:100%;">
                <input type="hidden" name="projectId" th:value="${project.projectId}" />
                <th:block th:if="${_csrf != null}">
                  <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                </th:block>

                <!-- Note (optional) -->
                <input name="note" type="text"
                       class="form-control form-control-sm d-inline-block"
                       style="width: 55%; vertical-align: middle; margin-right:6px; margin-top:6px;"
                       placeholder="Add a note (optional)" />

                <button type="submit"
                        class="btn btn-outline-primary btn-sm"
                        th:disabled="${savedIds != null and savedIds.contains(project.projectId)}"
                        th:text="${(savedIds != null and savedIds.contains(project.projectId)) ? 'Saved' : 'Save to list'}">
                </button>
              </form>
            </th:block>
          </th:block>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Footer -->
<footer class="footer">
  <h4 style="color: white;">LOGO GOES HERE</h4><br>
  <div class="copy">Â© 2024 TUS GALLERY</div>

  <div class="bottom-links">
    <div class="links">
      <span>More Info</span>
      <a href="#">Home</a>
      <a href="#">About</a>
      <a href="#">Contact</a>
    </div>

    <div class="links">
      <span>Social Links</span>
      <a href="#"><i class="fab fa-facebook"></i></a>
      <a href="#"><i class="fab fa-twitter"></i></a>
      <a href="#"><i class="fab fa-instagram"></i></a>
    </div>
  </div>
</footer>

</body>
</html>
